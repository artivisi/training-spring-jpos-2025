<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>ATM Simulator</title>
</head>
<body>
    <h1 layout:fragment="page-title" class="text-2xl font-bold text-center mb-6">
        <a href="/" class="text-indigo-600 hover:text-indigo-800 mr-2">‚Üê</a>
        ATM Simulator
    </h1>

    <div layout:fragment="content">
        <!-- Progress Indicator (hidden by default) -->
        <div id="progressIndicator" class="hidden mb-4 p-4 rounded bg-blue-50 border border-blue-200">
            <div class="flex items-center">
                <svg class="animate-spin h-5 w-5 mr-3 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-blue-700 font-medium" id="progressText">Processing transaction...</span>
            </div>
        </div>

        <!-- Result Display -->
        <div id="result" class="hidden mb-4"></div>

        <!-- Sample Test Data Panel -->
        <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <h3 class="font-bold text-blue-800 mb-3">üìã Test Accounts</h3>
            <div class="space-y-3 text-sm">
                <!-- Account 1 - ENCRYPTED_PIN_BLOCK -->
                <div class="bg-white p-3 rounded border border-blue-100">
                    <p class="font-semibold text-gray-800">Account 1: John Doe (Encrypted PIN Block)</p>
                    <div class="mt-2 space-y-1 text-gray-600">
                        <p><span class="font-medium">PAN:</span> 4111111111111111</p>
                        <p><span class="font-medium">Account #:</span> 1234567890</p>
                        <p><span class="font-medium">PIN:</span> 1234</p>
                        <p><span class="font-medium">Balance:</span> IDR 5,000,000.00</p>
                        <p class="text-xs text-blue-600 mt-1">
                            ‚ÑπÔ∏è Uses ENCRYPTED_PIN_BLOCK verification (HSM decrypts PIN block)
                        </p>
                    </div>
                </div>

                <!-- Account 2 - PVV -->
                <div class="bg-white p-3 rounded border border-blue-100">
                    <p class="font-semibold text-gray-800">Account 2: Jane Smith (PVV Method)</p>
                    <div class="mt-2 space-y-1 text-gray-600">
                        <p><span class="font-medium">PAN:</span> 4111111111111111</p>
                        <p><span class="font-medium">Account #:</span> 0987654321</p>
                        <p><span class="font-medium">PIN:</span> 1234</p>
                        <p><span class="font-medium">PVV:</span> 0187</p>
                        <p><span class="font-medium">Balance:</span> IDR 3,000,000.00</p>
                        <p class="text-xs text-green-600 mt-1">
                            ‚ÑπÔ∏è Uses PVV (PIN Verification Value) method
                        </p>
                    </div>
                </div>

                <div class="pt-2 border-t border-blue-200">
                    <p class="text-xs text-gray-500">
                        üí° <strong>Tip:</strong> Both accounts use the same PAN but different account numbers.
                        The PAN is used for PIN block encryption, while the account number determines which account to access.
                        This demonstrates two PIN verification methods: Account 1 uses ENCRYPTED_PIN_BLOCK (HSM decrypts), Account 2 uses PVV (hash-based).
                    </p>
                </div>
            </div>
        </div>

        <form id="atmForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Card Number (PAN)</label>
                <input type="text" id="pan" name="pan"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                       placeholder="4111111111111111" required>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Account Number</label>
                <input type="text" id="accountNumber" name="accountNumber"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                       placeholder="1234567890" required>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">PIN</label>
                <input type="password" id="pin" name="pin"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                       placeholder="1234" required>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Transaction Type</label>
                <select id="type" name="type"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <option value="BALANCE">Balance Inquiry</option>
                    <option value="WITHDRAWAL">Cash Withdrawal</option>
                </select>
            </div>

            <div id="amountField" class="hidden">
                <label class="block text-sm font-medium text-gray-700">Amount</label>
                <input type="number" id="amount" name="amount"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                       placeholder="100.00" step="0.01">
            </div>

            <button type="submit"
                    class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                Execute Transaction
            </button>
        </form>
    </div>

    <div layout:fragment="navigation" class="mt-6 text-center">
        <a href="/keys" class="text-indigo-600 hover:text-indigo-800">Key Management</a>
    </div>

    <script layout:fragment="scripts" src="/js/app.js"></script>
</body>
</html>
